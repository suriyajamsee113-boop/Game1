<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Mini Kahoot</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  font-family: sans-serif;
  background: #f2f2f2;
  text-align: center;
}
.card {
  background: white;
  padding: 20px;
  margin: 20px auto;
  border-radius: 12px;
  max-width: 400px;
}
button {
  width: 100%;
  padding: 12px;
  margin: 6px 0;
  font-size: 18px;
  border-radius: 8px;
  border: none;
  background: #4f46e5;
  color: white;
}
button:hover {
  background: #4338ca;
}
input {
  width: 100%;
  padding: 10px;
  font-size: 16px;
}
</style>
</head>
<body>

<h1>üéÆ Mini Kahoot</h1>

<div class="card" id="login">
  <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°</h2>
  <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô">
  <button onclick="joinGame()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
</div>

<div class="card" id="game" style="display:none;">
  <h2 id="question">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°...</h2>
  <div id="choices"></div>
</div>

<div class="card">
  <h2>üèÜ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
  <ul id="scores"></ul>
</div>

<script>
// ================= Firebase Config =================
const firebaseConfig = {
  apiKey: "AIzaSyCWZRDRx0SYNivY2BIsepJZxwjkYKtnKms",
  authDomain: "game-6fda9.firebaseapp.com",
  databaseURL: "https://game-6fda9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "game-6fda9",
  storageBucket: "game-6fda9.firebasestorage.app",
  messagingSenderId: "121486223888",
  appId: "1:121486223888:web:10f81ae5f492e80d31b895",
  measurementId: "G-3KK1KLJ71E"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================= Game Config =================
const room = "room1";
const playerId = Math.random().toString(36).substr(2, 9);

// ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ)
const questionData = {
  text: "205 + 330 = ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?",
  choices: ["500", "520", "535", "550"],
  answer: 1
};

// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô)
db.ref(room + "/question").set(questionData);

// ================= Join Game =================
function joinGame() {
  const name = document.getElementById("name").value;
  if (!name) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠");
    return;
  }

  db.ref(room + "/players/" + playerId).set({
    name: name,
    score: 0
  });

  document.getElementById("login").style.display = "none";
  document.getElementById("game").style.display = "block";
}

// ================= Show Question =================
db.ref(room + "/question").on("value", snapshot => {
  const q = snapshot.val();
  if (!q) return;

  document.getElementById("question").innerText = q.text;
  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "";

  q.choices.forEach((choice, index) => {
    const btn = document.createElement("button");
    btn.innerText = choice;
    btn.onclick = () => submitAnswer(index);
    choicesDiv.appendChild(btn);
  });
});

// ================= Answer =================
function submitAnswer(choiceIndex) {
  if (choiceIndex === questionData.answer) {
    db.ref(room + "/players/" + playerId + "/score")
      .transaction(score => (score || 0) + 1);
  }
  alert("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß!");
}

// ================= Scoreboard =================
db.ref(room + "/players").on("value", snapshot => {
  const players = snapshot.val() || {};
  const scoreList = document.getElementById("scores");
  scoreList.innerHTML = "";

  Object.values(players)
    .sort((a, b) => b.score - a.score)
    .forEach(player => {
      const li = document.createElement("li");
      li.innerText = `${player.name} : ${player.score}`;
      scoreList.appendChild(li);
    });
});
</script>

</body>
</html>
